# Evolution Demo - Changes Summary

## ä¿®æ”¹æ—¥æœŸ: 2025-10-20

### å®ç°çš„ä¸‰ä¸ªä¸»è¦åŠŸèƒ½:

## 1. ğŸ¨ å¯è§†åŒ–ä¿¡æ¯ç´  (Pheromone Visualization)

### ä¿®æ”¹æ–‡ä»¶: `viz/advanced_render.py`

**å˜æ›´å†…å®¹:**
- å¤§å¹…å¢å¼ºé£Ÿç‰©ä¿¡æ¯ç´  (PHER_FOOD) çš„å¯è§åº¦:
  - çº¢è‰²é€šé“: 0.25 â†’ 0.6
  - ç»¿è‰²é€šé“: 0.2 â†’ 0.5
  - æ–°å¢è“è‰²é€šé“: 0.1
  
- å¤§å¹…å¢å¼ºè¿”å®¶ä¿¡æ¯ç´  (PHER_HOME) çš„å¯è§åº¦:
  - è“è‰²é€šé“: 0.2 â†’ 0.5
  - ç»¿è‰²é€šé“: 0.1 â†’ 0.3
  - æ–°å¢çº¢è‰²é€šé“: 0.1

- åœ¨å›¾ä¾‹ä¸­æ–°å¢äº†ä¿¡æ¯ç´ æ ‡ç­¾:
  - Food Pher (é£Ÿç‰©ä¿¡æ¯ç´ ) - æ©™é»„è‰²
  - Home Pher (è¿”å®¶ä¿¡æ¯ç´ ) - è“ç´«è‰²

**æ•ˆæœ:** ç°åœ¨å¯ä»¥æ¸…æ™°åœ°çœ‹åˆ°ä»£ç†ç•™ä¸‹çš„ä¿¡æ¯ç´ è½¨è¿¹ï¼Œæ›´å®¹æ˜“ç†è§£å®ƒä»¬çš„è¡Œä¸ºæ¨¡å¼ã€‚

---

## 2. ğŸ’€ èƒ½é‡è€—å°½æ­»äº¡ + ç¹æ®–ç³»ç»Ÿ (Death & Breeding System)

### ä¿®æ”¹æ–‡ä»¶: `run/advanced_evolution_demo.py`

**å˜æ›´å†…å®¹:**

### A. è‡ªç„¶æ­»äº¡æœºåˆ¶
åœ¨ `step()` æ–¹æ³•ä¸­æ·»åŠ äº†:
- è‡ªåŠ¨ç§»é™¤æ­»äº¡çš„ä»£ç†
- æ‰“å°æ­»äº¡ç»Ÿè®¡ä¿¡æ¯
- å½“ç§ç¾¤æ•°é‡ä½äº 25% æ—¶è§¦å‘ç´§æ€¥ç¹æ®–

```python
# è‡ªç„¶é€‰æ‹©ï¼šä»åˆ—è¡¨ä¸­ç§»é™¤æ­»äº¡çš„ä»£ç†
previously_alive = len(self.agents)
self.agents = [a for a in self.agents if a.alive]
deaths = previously_alive - len(self.agents)
if deaths > 0:
    print(f"ğŸ’€ {deaths} agent(s) died from starvation. Remaining: {len(self.agents)}")
```

### B. ç¹æ®–ç³»ç»Ÿæ”¹é©
å°†åŸæ¥çš„"å®Œå…¨æ›¿æ¢"æ”¹ä¸º"è‚²ç§ç¹æ®–"ç³»ç»Ÿ:

**æ—§ç³»ç»Ÿ:** æ¯ä¸ªç¹æ®–å‘¨æœŸå®Œå…¨æ›¿æ¢æ‰€æœ‰ä»£ç†
**æ–°ç³»ç»Ÿ:** 
1. ä¿ç•™æœ€ä¼˜ç§€çš„ 25% ä½œä¸ºå¹¸å­˜è€…
2. æœ€ä¼˜ç§€çš„ 40% æˆä¸ºç¹æ®–çˆ¶æ¯æ± 
3. é€šè¿‡äº¤å‰ç¹æ®–äº§ç”Ÿåä»£
4. åä»£æ•°é‡ = ç›®æ ‡æ•°é‡ - å¹¸å­˜è€…æ•°é‡

```python
# é€‰æ‹©ç¹æ®–çˆ¶æ¯ - å‰40%å¯ä»¥ç¹æ®–
parent_pool_size = max(2, int(len(alive) * 0.4))
parents = alive[:parent_pool_size]

# ä¿ç•™æœ€ä¼˜ç§€çš„çˆ¶æ¯ï¼ˆå‰25%ï¼‰
survivors = alive[:max(2, int(len(alive) * 0.25))]
```

**æ•ˆæœ:** 
- æ›´çœŸå®çš„è¿›åŒ–æ¨¡æ‹Ÿ
- ä¼˜ç§€åŸºå› å¾—ä»¥å»¶ç»­
- ç§ç¾¤åŠ¨æ€æ›´åŠ è‡ªç„¶

---

## 3. ğŸ§± å›ºä½“å¢™å£ç¢°æ’æ£€æµ‹ (Solid Wall Collision)

### ä¿®æ”¹æ–‡ä»¶: 
- `logic/tools_advanced.py` (ä¸»è¦)
- `policy/policy_advanced.py`

**å˜æ›´å†…å®¹:**

### A. ç§»é™¤æ¨¡è¿ç®—åŒ…è£…
æ‰€æœ‰ä½¿ç”¨ `% W` å’Œ `% H` çš„åœ°æ–¹éƒ½æ”¹ä¸ºä½¿ç”¨ `world.in_bounds()` æ£€æŸ¥:

**ä¹‹å‰:**
```python
nx = (x + dx) % W
ny = (y + dy) % H
if world.layers["SOLID"][ny, nx] > 0:
```

**ç°åœ¨:**
```python
nx = x + dx
ny = y + dy
if not world.in_bounds(nx, ny) or world.layers["SOLID"][ny, nx] > 0:
```

### B. ä¿®æ”¹çš„å‡½æ•°
1. `tool_hunt_food_advanced()` - å¯»æ‰¾é£Ÿç‰©æ—¶çš„ç§»åŠ¨
2. `tool_go_home_advanced()` - è¿”å›å®¶å›­æ—¶çš„ç§»åŠ¨
3. `tool_find_nest_location()` - æŸ¥æ‰¾å·¢ç©´ä½ç½®
4. `tool_find_storage_location()` - æŸ¥æ‰¾å‚¨è—ä½ç½®
5. `tool_should_build_nest()` - æ£€æŸ¥æ˜¯å¦åº”è¯¥å»ºé€ å·¢ç©´
6. `tool_should_build_storage()` - æ£€æŸ¥æ˜¯å¦åº”è¯¥å»ºé€ å‚¨è—å®¤
7. `_would_hit_wall()` - å¢™å£ç¢°æ’æ£€æµ‹
8. `policy_advanced.py` ä¸­çš„é‚»è¿‘é£Ÿç‰©æ£€æµ‹

**æ•ˆæœ:**
- ä»£ç†ä¸èƒ½å†ç©¿è¶Šå›ºä½“å¢™å£
- ä»£ç†ä¸èƒ½åœ¨ä¸–ç•Œè¾¹ç•Œ"ç¯ç»•"
- å¿…é¡»ç»•è·¯é¿å¼€éšœç¢ç‰©
- æ›´çœŸå®çš„ç‰©ç†è¡Œä¸º

---

## å·²éªŒè¯çš„ç°æœ‰åŠŸèƒ½

### èƒ½é‡è€—å°½æ­»äº¡ (åœ¨ `core/advanced_agent.py` ä¸­)
```python
# èƒ½é‡è€—å°½åˆ™æ­»äº¡
if self.energy <= 0:
    self.alive = False
```

è¿™ä¸ªåŠŸèƒ½å·²ç»å­˜åœ¨äºä»£ç ä¸­ï¼Œåªéœ€è¦ç¡®ä¿åœ¨ä¸»å¾ªç¯ä¸­æ­£ç¡®å¤„ç†æ­»äº¡ä»£ç†å³å¯ã€‚

---

## æµ‹è¯•å»ºè®®

è¿è¡Œæ¼”ç¤ºæ—¶åº”è¯¥è§‚å¯Ÿåˆ°:

1. **ä¿¡æ¯ç´ å¯è§æ€§**: 
   - ä»£ç†èµ°è¿‡çš„è·¯å¾„åº”è¯¥æ˜¾ç¤ºæ˜æ˜¾çš„æ©™é»„è‰²(é£Ÿç‰©ä¿¡æ¯ç´ )æˆ–è“ç´«è‰²(è¿”å®¶ä¿¡æ¯ç´ )è½¨è¿¹
   
2. **æ­»äº¡æœºåˆ¶**:
   - ä»£ç†èƒ½é‡è€—å°½æ—¶ä¼šä»ä¸–ç•Œä¸­æ¶ˆå¤±
   - æ§åˆ¶å°ä¼šæ‰“å°æ­»äº¡ä¿¡æ¯
   - ç§ç¾¤æ•°é‡ä¼šåŠ¨æ€å˜åŒ–

3. **ç¹æ®–ç³»ç»Ÿ**:
   - æ¯ä¸ªç¹æ®–å‘¨æœŸåï¼Œæœ€ä¼˜ç§€çš„ä»£ç†ä¼šå­˜æ´»ä¸‹æ¥
   - æ–°ç”Ÿä»£ç†æ˜¯é€šè¿‡äº¤å‰ç¹æ®–äº§ç”Ÿçš„ï¼Œä¸æ˜¯éšæœºç”Ÿæˆ
   - æ§åˆ¶å°ä¼šæ˜¾ç¤ºå¹¸å­˜è€…å’Œåä»£çš„æ•°é‡

4. **å¢™å£ç¢°æ’**:
   - ä»£ç†é‡åˆ° SOLID å•å…ƒæ ¼æ—¶ä¼šè½¬å‘
   - ä»£ç†åˆ°è¾¾ä¸–ç•Œè¾¹ç¼˜æ—¶ä¼šè½¬å‘
   - ä¸ä¼šå†çœ‹åˆ°ä»£ç†"ç¬ç§»"åˆ°åœ°å›¾å¦ä¸€ä¾§

---

## è¿è¡Œå‘½ä»¤

```bash
cd /Users/ein/EinDev/OcctStuff/sources/helloworld
./run_advanced.sh
```

æˆ–è€…:

```bash
cd /Users/ein/EinDev/OcctStuff/sources/helloworld
/Users/ein/EinDev/OcctStuff/.venv/bin/python run/advanced_evolution_demo.py
```
