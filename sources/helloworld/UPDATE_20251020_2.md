# 演化模拟 - 第二次更新

## 更新时间: 2025-10-20

### 修改内容

## 1. 🟦 SOLID 层修改为二值(0/1)并用白色显示

### 修改文件:
- `core/advanced_agent.py`
- `core/expandable_world.py`
- `viz/advanced_render.py`

**变更:**
- 将所有 SOLID 设置从 `255` 改为 `1`
- 在渲染中，SOLID 显示为纯白色 (1.0, 1.0, 1.0)
- 更新图例，添加 "Solid (固体墙)" 标签

**效果:** 
- SOLID 只有0(无墙)和1(有墙)两种状态
- 墙壁显示为清晰的白色
- 更符合布尔逻辑，减少内存使用

---

## 2. ⬇️ 降低建造策略优先级

### 修改文件:
- `policy/policy_advanced.py`

**变更:**

### 优先级顺序（从高到低）:
1. **携带食物时返回家园** - 最高优先级
2. **寻找和采集食物** - 第二优先级
3. **探索和移动** - 第三优先级
4. **建造巢穴** - 降低到第四优先级
5. **建造储藏室** - 降低到第五优先级
6. **留下路径标记** - 最低优先级

### 具体调整:
- 寻找食物的逻辑移到建造之前
- 建造只在确认有足够食物后才考虑
- 大幅降低建造的触发概率:
  - 巢穴: 50% → 10%
  - 储藏室: 40% → 8%
  - 路径: 20%/10% → 5%/3%

**效果:** 
- 代理优先保证生存（寻找食物）
- 只在资源充足时才建造
- 减少不必要的能量消耗

---

## 3. 📊 建造需要足够食物

### 修改文件:
- `logic/tools_advanced.py`

**变更:**

### `tool_should_build_nest()`:
```python
# 之前:
- 能量要求: > 40
- 无食物要求

# 现在:
- 能量要求: > 60 (提高50%)
- 周围食物要求: >= 500 (新增)
```

### `tool_should_build_storage()`:
```python
# 之前:
- 能量要求: > 35
- 无食物要求

# 现在:
- 能量要求: > 50 (提高43%)
- 周围食物要求: >= 300 (新增)
```

### 检查范围:
- 巢穴: 11x11 区域 (-5到+5)
- 储藏室: 9x9 区域 (-4到+4)

**效果:**
- 必须在食物丰富的地区才能建造
- 避免在贫瘠区域浪费能量建造
- 鼓励在战略位置建造

---

## 完整的建造条件

### 建造巢穴 (BUILD_NEST):
1. 代理能量 > 60
2. 周围11x11区域食物总量 >= 500
3. 周围已有巢穴不超过50
4. 代理的建造倾向 > 0.5
5. 10%随机概率触发

### 建造储藏室 (BUILD_STORAGE):
1. 代理能量 > 60 (策略中)
2. 周围9x9区域食物总量 >= 300
3. 周围已有储藏室不超过30
4. 代理的建造倾向 > 0.6
5. 8%随机概率触发

### 留下路径 (BUILD_TRAIL):
1. 代理能量 > 30
2. 当前位置路径标记 < 100
3. 携带食物时: 5%概率
4. 寻找食物时: 3%概率

---

## 测试要点

运行演示时应该观察到:

1. **白色墙壁**: 
   - SOLID 单元格显示为纯白色
   - 清晰可见，不透明

2. **建造频率降低**:
   - 早期几乎不建造
   - 只在食物充足的区域才建造
   - 建造物出现得更晚、更少

3. **更好的生存策略**:
   - 代理优先寻找食物
   - 能量管理更好
   - 死亡率可能降低

4. **资源分配**:
   - 代理会在食物丰富的区域聚集
   - 在这些区域才会看到建筑物
   - 贫瘠区域保持干净

---

## 运行命令

```bash
cd /Users/ein/EinDev/OcctStuff/sources/helloworld
./run_advanced.sh
```

---

## 总结

这次更新让模拟更加真实和平衡:

✅ **SOLID 层简化** - 使用布尔值，白色显示，更清晰
✅ **优先级调整** - 生存优先，建造其次
✅ **资源约束** - 必须有足够食物才能建造

结果应该是一个更加稳定、合理的演化系统！
